{
  "kind": "build_request",
  "title": "Fix data loss and order save failures",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Investigate and fix the root cause of data loss affecting all saved information in the backend, ensuring stable canister state persistence across upgrades",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "all my data is loss"
        ]
      },
      "acceptanceCriteria": [
        "Existing data persists correctly across canister upgrades",
        "No data is lost when creating new records",
        "Backend state variables maintain their values between deployments"
      ]
    },
    {
      "id": "REQ-2",
      "text": "Fix the order save functionality to ensure orders can be successfully created and persisted without errors",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "i am not able to save orders"
        ]
      },
      "acceptanceCriteria": [
        "New orders can be created successfully through the OrderWizard",
        "Order data is correctly stored in the backend",
        "No errors occur during the order creation process",
        "Saved orders appear in the recent orders list immediately after creation"
      ]
    },
    {
      "id": "REQ-3",
      "text": "Add proper stable storage declarations for all state variables in the backend to prevent data loss during canister upgrades",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-latest"
        ]
      },
      "acceptanceCriteria": [
        "All state variables (orders, repair orders, piercing services, other services, user profiles) use stable storage",
        "Data survives canister upgrades without loss",
        "nextBillNo counter maintains its value across upgrades"
      ]
    },
    {
      "id": "REQ-4",
      "text": "Verify and fix frontend error handling and data validation in the OrderWizard to ensure proper error messages are shown if backend operations fail",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ]
      },
      "acceptanceCriteria": [
        "Clear error messages are displayed when order save fails",
        "Frontend properly handles and displays backend error responses",
        "User receives feedback about what went wrong during save operations"
      ]
    }
  ],
  "constraints": [
    "Maintain single-actor architecture in backend/main.mo",
    "Preserve existing Internet Identity authentication flow",
    "Keep all existing UI components and routing structure intact",
    "Do not modify read-only paths: frontend/src/hooks/useInternetIdentity.ts, frontend/src/hooks/useActor.ts, frontend/src/main.tsx, frontend/src/components/ui"
  ],
  "nonGoals": [
    "Adding new features beyond fixing the save and data loss issues",
    "Redesigning the UI or changing the visual appearance",
    "Modifying the authentication system",
    "Adding new service types or order fields"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}